/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /npm/opus-media-recorder@0.8.0/WebMOpusEncoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var Module=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return"undefined"!=typeof __filename&&(e=e||__filename),function(t){t=void 0!==(t=t||{})?t:{};const{EmscriptenMemoryAllocator:n}=require("./commonFunctions.js"),r=48e3;class o{constructor(e,o,i=void 0){this.config={inputSampleRate:e,channelCount:o},this.memory=new n(t),this._opus_encoder_create=t._opus_encoder_create,this._opus_encoder_ctl=t._opus_encoder_ctl,this._opus_encode_float=t._opus_encode_float,this._opus_encoder_destroy=t._opus_encoder_destroy,this._speex_resampler_init=t._speex_resampler_init,this._speex_resampler_process_interleaved_float=t._speex_resampler_process_interleaved_float,this._speex_resampler_destroy=t._speex_resampler_destroy,this._container=new t.Container,this._container.init(r,o,Math.floor(4294967295*Math.random())),this.OpusInitCodec(r,o,i),this.SpeexInitResampler(e,r,o),this.inputSamplesPerChannel=20*e/1e3,this.outputSamplePerChannel=960,this.inputBufferIndex=0,this.mInputBuffer=this.memory.mallocFloat32Buffer(this.inputSamplesPerChannel*o),this.mResampledBuffer=this.memory.mallocFloat32Buffer(this.outputSamplePerChannel*o),this.mOutputBuffer=this.memory.mallocUint8Buffer(4e3),this.interleavedBuffers=1!==o?new Float32Array(4096*o):void 0}encode(e){let t=this.interleave(e),n=0;for(;n<t.length;){let e=Math.min(this.mInputBuffer.length-this.inputBufferIndex,t.length-n);if(this.mInputBuffer.set(t.subarray(n,n+e),this.inputBufferIndex),this.inputBufferIndex+=e,this.inputBufferIndex>=this.mInputBuffer.length){let e=this.memory.mallocUint32(this.inputSamplesPerChannel),t=this.memory.mallocUint32(this.outputSamplePerChannel),n=this._speex_resampler_process_interleaved_float(this.resampler,this.mInputBuffer.pointer,e.pointer,this.mResampledBuffer.pointer,t.pointer);if(e.free(),t.free(),0!==n)throw new Error("Resampling error.");let r=this._opus_encode_float(this.encoder,this.mResampledBuffer.pointer,this.outputSamplePerChannel,this.mOutputBuffer.pointer,this.mOutputBuffer.length);if(r<0)throw new Error("Opus encoding error.");this._container.writeFrame(this.mOutputBuffer.pointer,r,this.outputSamplePerChannel),this.inputBufferIndex=0}n+=e}}close(){const{channelCount:e}=this.config;let n=[];for(let t=0;t<e;++t)n.push(new Float32Array(4096-this.inputBufferIndex/e));this.encode(n),t.destroy(this._container),this.mInputBuffer.free(),this.mResampledBuffer.free(),this.mOutputBuffer.free(),this._opus_encoder_destroy(this.encoder),this._speex_resampler_destroy(this.resampler)}interleave(e){const t=e.length;if(1===t)return e[0];for(let n=0;n<t;n++){let r=e[n];for(let e=0;e<r.length;e++)this.interleavedBuffers[e*t+n]=r[e]}return this.interleavedBuffers}OpusInitCodec(e,t,n=void 0){let r=this.memory.mallocUint32(void 0);this.encoder=this._opus_encoder_create(e,t,2049,r.pointer);let o=r.value;if(r.free(),0!==o)throw new Error("Opus encodor initialization failed.");n&&this.OpusSetOpusControl(4002,n)}OpusSetOpusControl(e,t){let n=this.memory.mallocInt32(t);this._opus_encoder_ctl(this.encoder,e,n.pointer),n.free()}SpeexInitResampler(e,t,n){let r=this.memory.mallocUint32(void 0);this.resampler=this._speex_resampler_init(n,e,t,6,r.pointer);let o=r.value;if(r.free(),0!==o)throw new Error("Initializing resampler failed.")}}t.init=function(e,n,r){t.encodedBuffers=[],t.encoder=new o(e,n,r)},t.encode=function(e){t.encoder.encode(e)},t.flush=function(){return t.encodedBuffers.splice(0,t.encodedBuffers.length)},t.close=function(){t.encoder.close()};var i,s={};for(i in t)t.hasOwnProperty(i)&&(s[i]=t[i]);var u,a,p=[],f=!1,c=!1;f="object"==typeof window,c="function"==typeof importScripts,u="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,a=!f&&!u&&!c;var l,_,d,m,h="";u?(h=c?require("path").dirname(h)+"/":__dirname+"/",l=function(e,t){return d||(d=require("fs")),m||(m=require("path")),e=m.normalize(e),d.readFileSync(e,t?null:"utf8")},_=function(e){var t=l(e,!0);return t.buffer||(t=new Uint8Array(t)),C(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),p=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof ne))throw e})),process.on("unhandledRejection",H),function(e){process.exit(e)},t.inspect=function(){return"[Emscripten Module object]"}):a?("undefined"!=typeof read&&(l=function(e){return read(e)}),_=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(C("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?p=scriptArgs:void 0!==arguments&&(p=arguments),"function"==typeof quit&&function(e){quit(e)},"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(f||c)&&(c?h=self.location.href:document.currentScript&&(h=document.currentScript.src),e&&(h=e),h=0!==h.indexOf("blob:")?h.substr(0,h.lastIndexOf("/")+1):"",l=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},c&&(_=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var y,v,b=t.print||console.log.bind(console),w=t.printErr||console.warn.bind(console);for(i in s)s.hasOwnProperty(i)&&(t[i]=s[i]);s=null,t.arguments&&(p=t.arguments),t.thisProgram&&t.thisProgram,t.quit&&t.quit,t.wasmBinary&&(y=t.wasmBinary),t.noExitRuntime&&t.noExitRuntime,"object"!=typeof WebAssembly&&w("no native wasm support detected");var g=new WebAssembly.Table({initial:60,maximum:60,element:"anyfunc"}),x=!1;function C(e,t){e||H("Assertion failed: "+t)}var A="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function B(e,t,n){for(var r=t+n,o=t;e[o]&&!(o>=r);)++o;if(o-t>16&&e.subarray&&A)return A.decode(e.subarray(t,o));for(var i="";t<o;){var s=e[t++];if(128&s){var u=63&e[t++];if(192!=(224&s)){var a=63&e[t++];if((s=224==(240&s)?(15&s)<<12|u<<6|a:(7&s)<<18|u<<12|a<<6|63&e[t++])<65536)i+=String.fromCharCode(s);else{var p=s-65536;i+=String.fromCharCode(55296|p>>10,56320|1023&p)}}else i+=String.fromCharCode((31&s)<<6|u)}else i+=String.fromCharCode(s)}return i}function I(e,t){return e?B(S,e,t):""}var R,S,E;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var P,O=t.INITIAL_MEMORY||16777216;function j(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var r=n.func;"number"==typeof r?void 0===n.arg?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(void 0===n.arg?null:n.arg)}else n()}}(v=t.wasmMemory?t.wasmMemory:new WebAssembly.Memory({initial:O/65536,maximum:O/65536}))&&(R=v.buffer),O=R.byteLength,R=P=R,t.HEAP8=new Int8Array(P),t.HEAP16=new Int16Array(P),t.HEAP32=E=new Int32Array(P),t.HEAPU8=S=new Uint8Array(P),t.HEAPU16=new Uint16Array(P),t.HEAPU32=new Uint32Array(P),t.HEAPF32=new Float32Array(P),t.HEAPF64=new Float64Array(P),E[11496]=5289024;var M=[],F=[],U=[],T=[];var W=0,D=null,q=null;function H(e){throw t.onAbort&&t.onAbort(e),b(e+=""),w(e),x=!0,1,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}t.preloadedImages={},t.preloadedAudios={};var z="data:application/octet-stream;base64,";function L(e){return String.prototype.startsWith?e.startsWith(z):0===e.indexOf(z)}var k,V="WebMOpusEncoder.wasm";function G(){try{if(y)return new Uint8Array(y);if(_)return _(V);throw"both async and sync fetching of the wasm failed"}catch(e){H(e)}}L(V)||(k=V,V=t.locateFile?t.locateFile(k,h):h+k),F.push({func:function(){K()}});var N={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=N.buffers[e];0===t||10===t?((1===e?b:w)(B(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return N.varargs+=4,E[N.varargs-4>>2]},getStr:function(e){return I(e)},get64:function(e,t){return e}};var X={a:function(e,t,n,r){H("Assertion failed: "+I(e)+", at: "+[t?I(t):"unknown filename",n,r?I(r):"unknown function"])},e:function(e,t,n){return N.varargs=n,0},h:function(e,t,n){N.varargs=n},g:function(e,t,n){return N.varargs=n,0},b:function(){H()},m:function(e,n){let r=new Uint8Array(t.HEAPU8.buffer,e,n);t.encodedBuffers.push(new Uint8Array(r).buffer)},k:function(e,t,n){S.copyWithin(e,t,t+n)},l:function(e){H("OOM")},c:function(e){return 0},f:function(e,t,n,r){var o=N.getStreamFromFD(e),i=N.doReadv(o,t,n);return E[r>>2]=i,0},j:function(e,t,n,r,o){},d:function(e,t,n,r){for(var o=0,i=0;i<n;i++){for(var s=E[t+8*i>>2],u=E[t+(8*i+4)>>2],a=0;a<u;a++)N.printChar(e,S[s+a]);o+=u}return E[r>>2]=o,0},memory:v,table:g,i:function(e){var t=Date.now()/1e3|0;return e&&(E[e>>2]=t),t}},Y=function(){var e={a:X};function n(e,n){var r=e.exports;t.asm=r,function(e){if(W--,t.monitorRunDependencies&&t.monitorRunDependencies(W),0==W&&(null!==D&&(clearInterval(D),D=null),q)){var n=q;q=null,n()}}()}function r(e){n(e.instance)}function o(t){return(y||!f&&!c||"function"!=typeof fetch?new Promise((function(e,t){e(G())})):fetch(V,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+V+"'";return e.arrayBuffer()})).catch((function(){return G()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){w("failed to asynchronously prepare wasm: "+e),H(e)}))}if(W++,t.monitorRunDependencies&&t.monitorRunDependencies(W),t.instantiateWasm)try{return t.instantiateWasm(e,n)}catch(e){return w("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(y||"function"!=typeof WebAssembly.instantiateStreaming||L(V)||"function"!=typeof fetch)return o(r);fetch(V,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){w("wasm streaming compile failed: "+e),w("falling back to ArrayBuffer instantiation"),o(r)}))}))}(),{}}();t.asm=Y;var J,K=t.___wasm_call_ctors=function(){return(K=t.___wasm_call_ctors=t.asm.n).apply(null,arguments)},Q=(t.___em_js__emscriptenPushBuffer=function(){return(t.___em_js__emscriptenPushBuffer=t.asm.o).apply(null,arguments)},t._emscripten_bind_VoidPtr___destroy___0=function(){return(Q=t._emscripten_bind_VoidPtr___destroy___0=t.asm.p).apply(null,arguments)}),Z=t._emscripten_bind_Container_Container_0=function(){return(Z=t._emscripten_bind_Container_Container_0=t.asm.q).apply(null,arguments)},$=t._emscripten_bind_Container_init_3=function(){return($=t._emscripten_bind_Container_init_3=t.asm.r).apply(null,arguments)},ee=t._emscripten_bind_Container_writeFrame_3=function(){return(ee=t._emscripten_bind_Container_writeFrame_3=t.asm.s).apply(null,arguments)},te=t._emscripten_bind_Container___destroy___0=function(){return(te=t._emscripten_bind_Container___destroy___0=t.asm.t).apply(null,arguments)};t._opus_encoder_create=function(){return(t._opus_encoder_create=t.asm.u).apply(null,arguments)},t._opus_encode_float=function(){return(t._opus_encode_float=t.asm.v).apply(null,arguments)},t._opus_encoder_ctl=function(){return(t._opus_encoder_ctl=t.asm.w).apply(null,arguments)},t._opus_encoder_destroy=function(){return(t._opus_encoder_destroy=t.asm.x).apply(null,arguments)},t._speex_resampler_init=function(){return(t._speex_resampler_init=t.asm.y).apply(null,arguments)},t._speex_resampler_destroy=function(){return(t._speex_resampler_destroy=t.asm.z).apply(null,arguments)},t._speex_resampler_process_interleaved_float=function(){return(t._speex_resampler_process_interleaved_float=t.asm.A).apply(null,arguments)},t._free=function(){return(t._free=t.asm.B).apply(null,arguments)},t._malloc=function(){return(t._malloc=t.asm.C).apply(null,arguments)},t.dynCall_vi=function(){return(t.dynCall_vi=t.asm.D).apply(null,arguments)},t.dynCall_v=function(){return(t.dynCall_v=t.asm.E).apply(null,arguments)};function ne(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function n(){J||(J=!0,t.calledRun=!0,x||(!0,j(F),j(U),t.onRuntimeInitialized&&t.onRuntimeInitialized(),function(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)e=t.postRun.shift(),T.unshift(e);var e;j(T)}()))}e=e||p,W>0||(!function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)e=t.preRun.shift(),M.unshift(e);var e;j(M)}(),W>0||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),n()}),1)):n()))}if(t.asm=Y,t.then=function(e){if(J)e(t);else{var n=t.onRuntimeInitialized;t.onRuntimeInitialized=function(){n&&n(),e(t)}}return t},q=function e(){J||re(),J||(q=e)},t.run=re,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();function oe(){}function ie(e){return(e||oe).__cache__}function se(e,t){var n=ie(t),r=n[e];return r||((r=Object.create((t||oe).prototype)).ptr=e,n[e]=r)}re(),oe.prototype=Object.create(oe.prototype),oe.prototype.constructor=oe,oe.prototype.__class__=oe,oe.__cache__={},t.WrapperObject=oe,t.getCache=ie,t.wrapPointer=se,t.castObject=function(e,t){return se(e.ptr,t)},t.NULL=se(0),t.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete ie(e.__class__)[e.ptr]},t.compare=function(e,t){return e.ptr===t.ptr},t.getPointer=function(e){return e.ptr},t.getClass=function(e){return e.__class__};function ue(){throw"cannot construct a VoidPtr, no constructor in IDL"}function ae(){this.ptr=Z(),ie(ae)[this.ptr]=this}return ue.prototype=Object.create(oe.prototype),ue.prototype.constructor=ue,ue.prototype.__class__=ue,ue.__cache__={},t.VoidPtr=ue,ue.prototype.__destroy__=ue.prototype.__destroy__=function(){var e=this.ptr;Q(e)},ae.prototype=Object.create(oe.prototype),ae.prototype.constructor=ae,ae.prototype.__class__=ae,ae.__cache__={},t.Container=ae,ae.prototype.init=ae.prototype.init=function(e,t,n){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),n&&"object"==typeof n&&(n=n.ptr),$(r,e,t,n)},ae.prototype.writeFrame=ae.prototype.writeFrame=function(e,t,n){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),n&&"object"==typeof n&&(n=n.ptr),ee(r,e,t,n)},ae.prototype.__destroy__=ae.prototype.__destroy__=function(){var e=this.ptr;te(e)},t}}();"object"==typeof exports&&"object"==typeof module?module.exports=Module:"function"==typeof define&&define.amd?define([],(function(){return Module})):"object"==typeof exports&&(exports.Module=Module);
//# sourceMappingURL=/sm/877ceee79500957407584caa442b8bb5f0da0af6bbdb93ecc10d50bb43bd7d9e.map